name: os-release
type: shell
commands:
  - PRETTY_VERSION=$(cat /version.json | jq -r ".version_id")
  - TAG=$(cat /version.json | jq -r ".tag")
  - IMAGE_ID=$(cat /version.json | jq -r ".image_id")
  - VERSION=${TAG}.${IMAGE_ID}
  - sed "s/%pretty_version%/${PRETTY_VERSION}/g" /sources/os-release/os-release.in/os-release.in > /sources/os-release/os-release
  - sed -i "s/%version%/${VERSION}/g" /sources/os-release/os-release
  - cp /sources/os-release/os-release /sysroot/usr/lib/os-release
  - cp /sources/os-release/os-release /usr/lib/os-release
  - cp /sources/os-release/os-release /etc/os-release
  - mv /sources/os-release/os-release /sysroot/etc/os-release
sources:
  - type: local
    url: files/os-release/os-release.in
